import{r as E}from"./rolldown-runtime-km5iIlDX.js";import{b as P}from"./chart-vendor-BxLEm8EH.js";import{f as j,l as c,u as B,v as O,y as D}from"./react-vendor-B8Gnojlf.js";import{n as K,r as S,t as W}from"./index-BgP2VN91.js";var o=E(P(),1),e=B(),H=()=>{const{lessonId:a}=D(),z=O(),{user:G}=K(),[y,_]=(0,o.useState)(null),[l,q]=(0,o.useState)([]),[t,d]=(0,o.useState)(0),[i,f]=(0,o.useState)({}),[L,N]=(0,o.useState)(!0),[u,v]=(0,o.useState)(!1),[x,h]=(0,o.useState)("");(0,o.useEffect)(()=>{(async()=>{try{N(!0);const s=await S.getLesson(a);_(s.data.lesson),q(s.data.quizzes||[])}catch(s){console.error("Error fetching quiz:",s),h("Gagal memuat latihan soal")}finally{N(!1)}})()},[a]);const g=l[t],w=g?.id||`q-${t}`,m=l.length,$=t===m-1,p=Object.keys(i).length===m;(0,o.useEffect)(()=>{const r=sessionStorage.getItem(`quiz_progress_${a}`);if(r)try{const s=JSON.parse(r);f(s.selectedAnswers||{}),d(s.currentQuestionIndex||0),c.success("Progress latihan soal dipulihkan",{id:"restore-progress"})}catch(s){console.error("Failed to restore quiz progress",s),sessionStorage.removeItem(`quiz_progress_${a}`)}},[a]),(0,o.useEffect)(()=>{if(Object.keys(i).length>0||t>0){const r={selectedAnswers:i,currentQuestionIndex:t,timestamp:Date.now()};sessionStorage.setItem(`quiz_progress_${a}`,JSON.stringify(r))}},[i,t,a]);const Q=r=>{const s={...i};s[w]=r,f(s)},I=()=>{t<m-1&&d(t+1)},A=()=>{t>0&&d(t-1)},C=async()=>{if(!p){c.error("Silakan jawab semua pertanyaan terlebih dahulu");return}v(!0),h("");const r=c.loading("Mengirim jawaban...");try{const s=Object.entries(i).map(([b,M])=>({quiz_id:b,selected_answer:M}));console.log("=== QUIZ SUBMISSION DEBUG ==="),console.log("Lesson ID:",a),console.log("Total questions:",m),console.log("Answers count:",s.length),console.log("Sample answer:",s[0]),console.log("All quiz IDs:",l.map(b=>b.id)),console.log("============================");const n=await S.submitQuiz(a,s);console.log("✅ Submission successful!",n.data),sessionStorage.removeItem(`quiz_progress_${a}`),c.success("Latihan soal berhasil dikirim!",{id:r}),z(`/quiz-results/${a}`,{state:{results:n.data,lesson:y,answers:i,quizzes:l}})}catch(s){console.error("❌ Submit error:",s),console.error("Error message:",s.message),console.error("Error response:",s.response);let n="Gagal submit latihan soal. ";s.message.includes("401")||s.message.includes("Unauthorized")?n+="Silakan login kembali.":s.message.includes("Network")?n+="Periksa koneksi internet Anda.":n+="Silakan coba lagi.",h(n),c.error(n,{id:r})}finally{v(!1)}},k=()=>Math.round(Object.keys(i).length/m*100);return L?(0,e.jsx)("div",{className:"page-container py-12",children:(0,e.jsx)("div",{className:"container-main",children:(0,e.jsx)(W,{size:"lg",text:"Memuat latihan soal..."})})}):x&&!l.length?(0,e.jsx)("div",{className:"page-container py-12",children:(0,e.jsxs)("div",{className:"container-main text-center",children:[(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Gagal memuat soal"}),(0,e.jsx)("p",{className:"text-gray-500 mb-4",children:x}),(0,e.jsx)(j,{to:`/lesson/${a}`,className:"btn-primary",children:"Kembali ke Pembahasan"})]})}):l.length===0?(0,e.jsx)("div",{className:"page-container py-12",children:(0,e.jsxs)("div",{className:"container-main text-center",children:[(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Tidak ada soal"}),(0,e.jsx)("p",{className:"text-gray-500 mb-4",children:"Latihan soal belum tersedia untuk pembahasan ini."}),(0,e.jsx)(j,{to:`/lesson/${a}`,className:"btn-primary",children:"Kembali ke Pembahasan"})]})}):(0,e.jsx)("div",{className:"page-container py-4 sm:py-6",children:(0,e.jsxs)("div",{className:"container-main max-w-4xl px-3 sm:px-4",children:[(0,e.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,e.jsxs)(j,{to:`/lesson/${a}`,className:"inline-flex items-center text-sm sm:text-base text-gray-600 hover:text-primary-600 mb-3 sm:mb-4",children:[(0,e.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Kembali"]}),(0,e.jsx)("h1",{className:"text-lg sm:text-2xl font-bold text-gray-900 line-clamp-2",children:y?.title}),(0,e.jsx)("p",{className:"text-sm sm:text-base text-gray-500 mt-1",children:"Latihan Soal"})]}),(0,e.jsxs)("div",{className:"card p-3 sm:p-4 mb-4 sm:mb-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,e.jsxs)("span",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["Soal ",t+1,"/",m]}),(0,e.jsxs)("span",{className:"text-xs sm:text-sm text-gray-500",children:[k(),"% selesai"]})]}),(0,e.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5 sm:h-2",children:(0,e.jsx)("div",{className:"bg-primary-600 h-1.5 sm:h-2 rounded-full transition-all duration-300",style:{width:`${k()}%`}})})]}),(0,e.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2 mb-4 sm:mb-6 justify-center",children:l.map((r,s)=>{const n=i[l[s]?.id||`q-${s}`]!==void 0;return(0,e.jsx)("button",{onClick:()=>d(s),className:`w-7 h-7 sm:w-10 sm:h-10 rounded-full text-xs sm:text-sm font-medium transition-all ${s===t?"bg-primary-600 text-white":n?"bg-green-500 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:s+1},s)})}),(0,e.jsxs)("div",{className:"card p-4 sm:p-6 mb-4 sm:mb-6",children:[(0,e.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,e.jsxs)("span",{className:"inline-block px-2 sm:px-3 py-0.5 sm:py-1 bg-primary-100 text-primary-700 rounded-full text-xs sm:text-sm font-medium mb-3 sm:mb-4",children:["Soal ",t+1]}),(0,e.jsx)("h2",{className:"text-sm sm:text-lg font-medium text-gray-900 leading-relaxed",children:g?.question})]}),(0,e.jsx)("div",{className:"space-y-2 sm:space-y-3",children:g?.options?.map((r,s)=>{const n=i[w]===s;return(0,e.jsx)("button",{onClick:()=>Q(s),className:`w-full p-3 sm:p-4 rounded-lg border-2 text-left transition-all ${n?"border-primary-500 bg-primary-50 text-primary-900":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:(0,e.jsxs)("div",{className:"flex items-start",children:[(0,e.jsx)("span",{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center text-xs sm:text-sm font-medium mr-2 sm:mr-3 flex-shrink-0 ${n?"bg-primary-500 text-white":"bg-gray-100 text-gray-600"}`,children:["A","B","C","D","E"][s]}),(0,e.jsx)("span",{className:"text-xs sm:text-base mt-0.5 sm:mt-1",children:r})]})},s)})})]}),x&&(0,e.jsx)("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:x}),(0,e.jsxs)("div",{className:"flex justify-between items-center",children:[(0,e.jsxs)("button",{onClick:A,disabled:t===0,className:`flex items-center px-2 sm:px-4 py-2 rounded-lg text-xs sm:text-base font-medium transition-colors ${t===0?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:bg-gray-100"}`,children:[(0,e.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),(0,e.jsx)("span",{className:"hidden sm:inline",children:"Sebelumnya"}),(0,e.jsx)("span",{className:"sm:hidden",children:"Prev"})]}),(0,e.jsx)("div",{className:"flex gap-2 sm:gap-3",children:$?(0,e.jsx)("button",{onClick:C,disabled:!p||u,className:`flex items-center px-3 sm:px-6 py-2 rounded-lg text-xs sm:text-base font-medium transition-colors ${p&&!u?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:u?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("svg",{className:"animate-spin w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2",fill:"none",viewBox:"0 0 24 24",children:[(0,e.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,e.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,e.jsx)("span",{className:"hidden sm:inline",children:"Mengirim..."}),(0,e.jsx)("span",{className:"sm:hidden",children:"..."})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,e.jsx)("span",{className:"hidden sm:inline",children:"Selesai & Kirim"}),(0,e.jsx)("span",{className:"sm:hidden",children:"Kirim"})]})}):(0,e.jsxs)("button",{onClick:I,className:"btn-primary flex items-center text-xs sm:text-base px-3 sm:px-4 py-2",children:[(0,e.jsx)("span",{className:"hidden sm:inline",children:"Selanjutnya"}),(0,e.jsx)("span",{className:"sm:hidden",children:"Next"}),(0,e.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 ml-1 sm:ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]}),(0,e.jsxs)("div",{className:"mt-4 sm:mt-8 card p-3 sm:p-4",children:[(0,e.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2 sm:mb-3",children:"Ringkasan Jawaban"}),(0,e.jsx)("div",{className:"grid grid-cols-10 gap-1 sm:gap-2",children:l.map((r,s)=>(0,e.jsx)("div",{className:`w-full aspect-square rounded flex items-center justify-center text-[10px] sm:text-xs font-medium ${i[l[s]?.id||`q-${s}`]!==void 0?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:s+1},s))}),(0,e.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500 mt-2 sm:mt-3",children:[Object.keys(i).length," dari ",m," ","pertanyaan dijawab"]})]})]})})};export{H as default};
