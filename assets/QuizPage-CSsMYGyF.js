import{a as e,f as t,h as n,i as r,l as i,n as a,o,r as s,s as c,u as l}from"./index-D3yLV-Xw.js";var u=n(t(),1),d=e(),f=()=>{let{lessonId:e}=l(),t=i(),{user:n}=r(),[f,p]=(0,u.useState)(null),[m,h]=(0,u.useState)([]),[g,_]=(0,u.useState)(0),[v,y]=(0,u.useState)({}),[b,x]=(0,u.useState)(!0),[S,C]=(0,u.useState)(!1),[w,T]=(0,u.useState)(``);(0,u.useEffect)(()=>{(async()=>{try{x(!0);let t=await o.getLesson(e);p(t.data.lesson),h(t.data.quizzes||[])}catch(e){console.error(`Error fetching quiz:`,e),T(`Gagal memuat latihan soal`)}finally{x(!1)}})()},[e]);let E=m[g],D=E?.id||`q-${g}`,O=m.length,k=g===O-1,A=Object.keys(v).length===O;(0,u.useEffect)(()=>{let t=sessionStorage.getItem(`quiz_progress_${e}`);if(t)try{let e=JSON.parse(t);y(e.selectedAnswers||{}),_(e.currentQuestionIndex||0),a.success(`Progress latihan soal dipulihkan`,{id:`restore-progress`})}catch(t){console.error(`Failed to restore quiz progress`,t),sessionStorage.removeItem(`quiz_progress_${e}`)}},[e]),(0,u.useEffect)(()=>{if(Object.keys(v).length>0||g>0){let t={selectedAnswers:v,currentQuestionIndex:g,timestamp:Date.now()};sessionStorage.setItem(`quiz_progress_${e}`,JSON.stringify(t))}},[v,g,e]);let j=e=>{let t={...v};t[D]=e,y(t)},M=()=>{g<O-1&&_(g+1)},N=()=>{g>0&&_(g-1)},P=async()=>{if(!A){a.error(`Silakan jawab semua pertanyaan terlebih dahulu`);return}C(!0),T(``);let n=a.loading(`Mengirim jawaban...`);try{let r=Object.entries(v).map(([e,t])=>({quiz_id:e,selected_answer:t}));console.log(`=== QUIZ SUBMISSION DEBUG ===`),console.log(`Lesson ID:`,e),console.log(`Total questions:`,O),console.log(`Answers count:`,r.length),console.log(`Sample answer:`,r[0]),console.log(`All quiz IDs:`,m.map(e=>e.id)),console.log(`============================`);let i=await o.submitQuiz(e,r);console.log(`✅ Submission successful!`,i.data),sessionStorage.removeItem(`quiz_progress_${e}`),a.success(`Latihan soal berhasil dikirim!`,{id:n}),t(`/quiz-results/${e}`,{state:{results:i.data,lesson:f,answers:v,quizzes:m}})}catch(e){console.error(`❌ Submit error:`,e),console.error(`Error message:`,e.message),console.error(`Error response:`,e.response);let t=`Gagal submit latihan soal. `;e.message.includes(`401`)||e.message.includes(`Unauthorized`)?t+=`Silakan login kembali.`:e.message.includes(`Network`)?t+=`Periksa koneksi internet Anda.`:t+=`Silakan coba lagi.`,T(t),a.error(t,{id:n})}finally{C(!1)}},F=()=>Math.round(Object.keys(v).length/O*100);return b?(0,d.jsx)(`div`,{className:`page-container py-12`,children:(0,d.jsx)(`div`,{className:`container-main`,children:(0,d.jsx)(s,{size:`lg`,text:`Memuat latihan soal...`})})}):w&&!m.length?(0,d.jsx)(`div`,{className:`page-container py-12`,children:(0,d.jsxs)(`div`,{className:`container-main text-center`,children:[(0,d.jsx)(`h2`,{className:`text-xl font-semibold text-gray-900 mb-2`,children:`Gagal memuat soal`}),(0,d.jsx)(`p`,{className:`text-gray-500 mb-4`,children:w}),(0,d.jsx)(c,{to:`/lesson/${e}`,className:`btn-primary`,children:`Kembali ke Pembahasan`})]})}):m.length===0?(0,d.jsx)(`div`,{className:`page-container py-12`,children:(0,d.jsxs)(`div`,{className:`container-main text-center`,children:[(0,d.jsx)(`h2`,{className:`text-xl font-semibold text-gray-900 mb-2`,children:`Tidak ada soal`}),(0,d.jsx)(`p`,{className:`text-gray-500 mb-4`,children:`Latihan soal belum tersedia untuk pembahasan ini.`}),(0,d.jsx)(c,{to:`/lesson/${e}`,className:`btn-primary`,children:`Kembali ke Pembahasan`})]})}):(0,d.jsx)(`div`,{className:`page-container py-4 sm:py-6`,children:(0,d.jsxs)(`div`,{className:`container-main max-w-4xl px-3 sm:px-4`,children:[(0,d.jsxs)(`div`,{className:`mb-4 sm:mb-6`,children:[(0,d.jsxs)(c,{to:`/lesson/${e}`,className:`inline-flex items-center text-sm sm:text-base text-gray-600 hover:text-primary-600 mb-3 sm:mb-4`,children:[(0,d.jsx)(`svg`,{className:`w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,d.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M15 19l-7-7 7-7`})}),`Kembali`]}),(0,d.jsx)(`h1`,{className:`text-lg sm:text-2xl font-bold text-gray-900 line-clamp-2`,children:f?.title}),(0,d.jsx)(`p`,{className:`text-sm sm:text-base text-gray-500 mt-1`,children:`Latihan Soal`})]}),(0,d.jsxs)(`div`,{className:`card p-3 sm:p-4 mb-4 sm:mb-6`,children:[(0,d.jsxs)(`div`,{className:`flex justify-between items-center mb-2`,children:[(0,d.jsxs)(`span`,{className:`text-xs sm:text-sm font-medium text-gray-700`,children:[`Soal `,g+1,`/`,O]}),(0,d.jsxs)(`span`,{className:`text-xs sm:text-sm text-gray-500`,children:[F(),`% selesai`]})]}),(0,d.jsx)(`div`,{className:`w-full bg-gray-200 rounded-full h-1.5 sm:h-2`,children:(0,d.jsx)(`div`,{className:`bg-primary-600 h-1.5 sm:h-2 rounded-full transition-all duration-300`,style:{width:`${F()}%`}})})]}),(0,d.jsx)(`div`,{className:`flex flex-wrap gap-1.5 sm:gap-2 mb-4 sm:mb-6 justify-center`,children:m.map((e,t)=>{let n=v[m[t]?.id||`q-${t}`]!==void 0;return(0,d.jsx)(`button`,{onClick:()=>_(t),className:`w-7 h-7 sm:w-10 sm:h-10 rounded-full text-xs sm:text-sm font-medium transition-all ${t===g?`bg-primary-600 text-white`:n?`bg-green-500 text-white`:`bg-gray-200 text-gray-600 hover:bg-gray-300`}`,children:t+1},t)})}),(0,d.jsxs)(`div`,{className:`card p-4 sm:p-6 mb-4 sm:mb-6`,children:[(0,d.jsxs)(`div`,{className:`mb-4 sm:mb-6`,children:[(0,d.jsxs)(`span`,{className:`inline-block px-2 sm:px-3 py-0.5 sm:py-1 bg-primary-100 text-primary-700 rounded-full text-xs sm:text-sm font-medium mb-3 sm:mb-4`,children:[`Soal `,g+1]}),(0,d.jsx)(`h2`,{className:`text-sm sm:text-lg font-medium text-gray-900 leading-relaxed`,children:E?.question})]}),(0,d.jsx)(`div`,{className:`space-y-2 sm:space-y-3`,children:E?.options?.map((e,t)=>{let n=v[D]===t;return(0,d.jsx)(`button`,{onClick:()=>j(t),className:`w-full p-3 sm:p-4 rounded-lg border-2 text-left transition-all ${n?`border-primary-500 bg-primary-50 text-primary-900`:`border-gray-200 hover:border-gray-300 hover:bg-gray-50`}`,children:(0,d.jsxs)(`div`,{className:`flex items-start`,children:[(0,d.jsx)(`span`,{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center text-xs sm:text-sm font-medium mr-2 sm:mr-3 flex-shrink-0 ${n?`bg-primary-500 text-white`:`bg-gray-100 text-gray-600`}`,children:[`A`,`B`,`C`,`D`,`E`][t]}),(0,d.jsx)(`span`,{className:`text-xs sm:text-base mt-0.5 sm:mt-1`,children:e})]})},t)})})]}),w&&(0,d.jsx)(`div`,{className:`mb-4 sm:mb-6 p-3 sm:p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm`,children:w}),(0,d.jsxs)(`div`,{className:`flex justify-between items-center`,children:[(0,d.jsxs)(`button`,{onClick:N,disabled:g===0,className:`flex items-center px-2 sm:px-4 py-2 rounded-lg text-xs sm:text-base font-medium transition-colors ${g===0?`text-gray-400 cursor-not-allowed`:`text-gray-600 hover:bg-gray-100`}`,children:[(0,d.jsx)(`svg`,{className:`w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,d.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M15 19l-7-7 7-7`})}),(0,d.jsx)(`span`,{className:`hidden sm:inline`,children:`Sebelumnya`}),(0,d.jsx)(`span`,{className:`sm:hidden`,children:`Prev`})]}),(0,d.jsx)(`div`,{className:`flex gap-2 sm:gap-3`,children:k?(0,d.jsx)(`button`,{onClick:P,disabled:!A||S,className:`flex items-center px-3 sm:px-6 py-2 rounded-lg text-xs sm:text-base font-medium transition-colors ${A&&!S?`bg-green-600 text-white hover:bg-green-700`:`bg-gray-300 text-gray-500 cursor-not-allowed`}`,children:S?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(`svg`,{className:`animate-spin w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2`,fill:`none`,viewBox:`0 0 24 24`,children:[(0,d.jsx)(`circle`,{className:`opacity-25`,cx:`12`,cy:`12`,r:`10`,stroke:`currentColor`,strokeWidth:`4`}),(0,d.jsx)(`path`,{className:`opacity-75`,fill:`currentColor`,d:`M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z`})]}),(0,d.jsx)(`span`,{className:`hidden sm:inline`,children:`Mengirim...`}),(0,d.jsx)(`span`,{className:`sm:hidden`,children:`...`})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(`svg`,{className:`w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,d.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M5 13l4 4L19 7`})}),(0,d.jsx)(`span`,{className:`hidden sm:inline`,children:`Selesai & Kirim`}),(0,d.jsx)(`span`,{className:`sm:hidden`,children:`Kirim`})]})}):(0,d.jsxs)(`button`,{onClick:M,className:`btn-primary flex items-center text-xs sm:text-base px-3 sm:px-4 py-2`,children:[(0,d.jsx)(`span`,{className:`hidden sm:inline`,children:`Selanjutnya`}),(0,d.jsx)(`span`,{className:`sm:hidden`,children:`Next`}),(0,d.jsx)(`svg`,{className:`w-4 h-4 sm:w-5 sm:h-5 ml-1 sm:ml-2`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,d.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M9 5l7 7-7 7`})})]})})]}),(0,d.jsxs)(`div`,{className:`mt-4 sm:mt-8 card p-3 sm:p-4`,children:[(0,d.jsx)(`h3`,{className:`text-xs sm:text-sm font-medium text-gray-700 mb-2 sm:mb-3`,children:`Ringkasan Jawaban`}),(0,d.jsx)(`div`,{className:`grid grid-cols-10 gap-1 sm:gap-2`,children:m.map((e,t)=>(0,d.jsx)(`div`,{className:`w-full aspect-square rounded flex items-center justify-center text-[10px] sm:text-xs font-medium ${v[m[t]?.id||`q-${t}`]===void 0?`bg-gray-100 text-gray-500`:`bg-green-100 text-green-700`}`,children:t+1},t))}),(0,d.jsxs)(`p`,{className:`text-xs sm:text-sm text-gray-500 mt-2 sm:mt-3`,children:[Object.keys(v).length,` dari `,O,` `,`pertanyaan dijawab`]})]})]})})};export{f as default};